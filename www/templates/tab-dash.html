<ion-view view-title="Dashboard" hide-nav-bar="true">

    <div class="bar bar-header item-input-inset bar-positive" style="position: fixed;">
        <label class="item-input-wrapper">
            <input type="search" placeholder="Tìm kiếm deal..." ng-model="search.searchText">
        </label>
        <button class="button button-clear" ng-click="clear_search()">
            <i class="icon ion-ios-search"></i>
        </button>
    </div>

    <div class="bar bar-subheader">
        <button ng-click="crawl.getall()" class="button button-light" style="display:inline;"> All</button>
        <button ng-click="crawl.getuser()" class="button button-light" style="display:inline;"> User</button>
        <button ng-click="crawl.getcrawler()" class="button button-light" style="display:inline;"> Crawler</button>
    </div>

    <ion-content scroll="true" style="margin-top:70px;">

        <ion-refresher
            pulling-text="Pull to refresh..."
            on-refresh="doRefresh()">
        </ion-refresher>

        <div class="list card post-repeat"
             ng-repeat="post in feeds | filter:{description: search.searchText, post_type: crawl.desc}">

            <div ng-if="post.post_type == 'crawl'" class="item item-avatar">
                <img style="border-radius:0;" ng-if="post.user.avatar_url" ng-src="{{ post.user.avatar_url }}">
                <img style="border-radius:0;" ng-if="!post.user.avatar_url" ng-src="img/nguyen.jpg">
                <!-- check if crawler post -->
                <div ng-if="post.post_type == 'user' " style="position:absolute; right:15px; top:15px;">User Post</div>
                <div ng-if="post.post_type == 'crawl' " style="position:absolute; right:15px; top:15px;">Ads</div>
                <h2>{{ post.user.name | limitTo: 25 }}</h2>
                <p>Quận 2, HCM</p>
            </div>

            <div ng-if="post.post_type != 'crawl'" ng-click="GotoProfile(post.user.id)" class="item item-avatar">
                <img style="border-radius:0;" ng-if="post.user.avatar_url" ng-src="{{ post.user.avatar_url }}">
                <img style="border-radius:0;" ng-if="!post.user.avatar_url" ng-src="img/nguyen.jpg">
                <!-- check if crawler post -->
                <div ng-if="post.post_type == 'user' " style="position:absolute; right:15px; top:15px;">User Post</div>
                <div ng-if="post.post_type == 'crawl' " style="position:absolute; right:15px; top:15px;">Ads</div>
                <h2>{{ post.user.name | limitTo: 25 }}</h2>
                <p>Quận 2, HCM</p>
            </div>

            <div class="item item-body" ng-click="OpenDetail(post.id)">
                <img class="full-image" ng-src="{{ post.picture_url }}">
                <p style="margin-bottom:5px;">
                    {{ post.description }}
                </p>
                <p style="margin:5px 0;"><b>{{post.likes.count || 0}} người thích deal này</b></p>
                <p style="margin:5px 0;">
                    <a href="#" class="subdued"><i class="ion-android-star-outline" style="font-size:30px;"></i></a>
                    <a href="#" class="subdued"><i class="ion-ios-chatboxes-outline" style="font-size:30px;"></i></a>
                    <a href="#" class="subdued"><i class="ion-android-share-alt" style="font-size:30px;" ng-click=Share()></i></a>
                </p>
                <p style="margin:5px 0;">
                    <a href="#" class="subdued">Có {{post.comments.count || 0}} bình luận cho post này</a>
                </p>
            </div>
        </div>

        <ion-infinite-scroll
            on-infinite="loadMore()"
            distance="1%">
        </ion-infinite-scroll>

    </ion-content>
</ion-view>
